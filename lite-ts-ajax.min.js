!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var o=t();for(var n in o)("object"==typeof exports?exports:e)[n]=o[n]}}(self,(()=>(()=>{"use strict";var e=[function(e,t,o){var n=this&&this.__createBinding||(Object.create?function(e,t,o,n){void 0===n&&(n=o);var r=Object.getOwnPropertyDescriptor(t,o);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[o]}}),Object.defineProperty(e,n,r)}:function(e,t,o,n){void 0===n&&(n=o),e[n]=t[o]}),r=this&&this.__exportStar||function(e,t){for(var o in e)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||n(t,e,o)};Object.defineProperty(t,"__esModule",{value:!0}),r(o(1),t),r(o(5),t)},function(e,t,o){var n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AjaxRpc=t.Header=void 0;const r=o(2),i=o(3),a=o(4),s=o(5);var u,c;!function(e){e[e.timeout=504]="timeout",e[e.panic=599]="panic"}(u||(u={})),function(e){e[e.headersReceived=2]="headersReceived",e[e.loading=3]="loading",e[e.opened=1]="opened",e[e.unsent=0]="unsent",e[e.done=4]="done"}(c||(c={}));const d=/^\/[a-z-]+/;var p;!function(e){e.authToken="H-A-T",e.env="H-E",e.timeout="H-T"}(p=t.Header||(t.Header={}));class l extends s.RpcBase{constructor(e,t={[i.HttpMethod.get]:new r.GetRequestStrategy,[i.HttpMethod.post]:new a.PostRequestStrategy}){super(),this.m_BaseUrl=e,this.m_Strategy=t}callWithoutThrow(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,o)=>n(this,void 0,void 0,(function*(){var n;if(!this.m_Strategy[e.method])throw new Error(`AjaxRpc不支持HttpMethod.${e.method}`);const r=this.createXMLHttpRequest();r.timeout=(null===(n=null==e?void 0:e.header)||void 0===n?void 0:n[p.timeout])?parseInt(e.header[p.timeout]):l.timeout,e.route=e.route.includes("/mh/")?e.route:e.route.replace(d,(e=>e+"/mh")),e.route=this.m_BaseUrl+e.route,this.m_Strategy[e.method].open(r,e),this.appendHeader(r,l.header),this.appendHeader(r,e.header),r.onreadystatechange=()=>{if(r.readyState===c.done)if(200===r.status)try{t(JSON.parse(r.responseText))}catch(e){o({data:null,err:u.panic})}else o({data:null,err:u.panic})},r.ontimeout=()=>{o({data:null,err:u.timeout})},this.m_Strategy[e.method].send(r,e)}))))}))}appendHeader(e,t){Object.keys(null!=t?t:{}).forEach((o=>{e.setRequestHeader(o,t[o])}))}createXMLHttpRequest(){return new XMLHttpRequest}}t.AjaxRpc=l,l.body={},l.header={"Content-Type":"application/json;charset=UTF-8"},l.timeout=15e3},(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetRequestStrategy=void 0;const n=o(1);t.GetRequestStrategy=class{open(e,t){const o=Object.entries(Object.assign(Object.assign({},n.AjaxRpc.body),t.body)).reduce(((e,[t,o])=>(e.push(t,"=",o,"&"),e)),[t.route,"?"]);o.pop(),e.open(t.method,o.join(""),!0)}send(e){e.send()}}},(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.HttpMethod=void 0,function(e){e.get="GET",e.post="POST"}(t.HttpMethod||(t.HttpMethod={}))},(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostRequestStrategy=void 0;const n=o(1);t.PostRequestStrategy=class{open(e,t){e.open(t.method,t.route,!0)}send(e,t){e.send(JSON.stringify(Object.assign(Object.assign({},n.AjaxRpc.body),t.body)))}}},function(e,t){var o=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))((function(r,i){function a(e){try{u(n.next(e))}catch(e){i(e)}}function s(e){try{u(n.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,s)}u((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.RpcBase=void 0;class n{call(e){return o(this,void 0,void 0,(function*(){const t=yield this.callWithoutThrow(e);if(t.err)throw n.buildErrorFunc(t.err,t.data);return t.data}))}}t.RpcBase=n,n.ctor="RpcBase"}],t={};var o=function o(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,o),i.exports}(0);return o})()));