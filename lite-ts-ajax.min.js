!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("lite-ts-rpc"));else if("function"==typeof define&&define.amd)define(["lite-ts-rpc"],t);else{var o="object"==typeof exports?t(require("lite-ts-rpc")):t(e["lite-ts-rpc"]);for(var r in o)("object"==typeof exports?exports:e)[r]=o[r]}}(self,(e=>(()=>{"use strict";var t=[,function(e,t,o){var r=this&&this.__awaiter||function(e,t,o,r){return new(o||(o=Promise))((function(n,s){function a(e){try{d(r.next(e))}catch(e){s(e)}}function i(e){try{d(r.throw(e))}catch(e){s(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(a,i)}d((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.AjaxRpc=void 0;const n=o(2),s=o(3),a=o(4);var i,d;!function(e){e[e.timeout=504]="timeout",e[e.panic=599]="panic"}(i||(i={})),function(e){e[e.headersReceived=2]="headersReceived",e[e.loading=3]="loading",e[e.opened=1]="opened",e[e.unsent=0]="unsent",e[e.done=4]="done"}(d||(d={}));const c=/^\/[a-z-]+/;class u extends n.RpcBase{constructor(e,t={[n.HttpMethod.get]:new s.GetRequestStrategy,[n.HttpMethod.post]:new a.PostRequestStrategy}){super(),this.m_BaseUrl=e,this.m_Strategy=t}callWithoutThrow(e){var t;return r(this,void 0,void 0,(function*(){if(null!==(t=e.method)&&void 0!==t||(e.method=n.HttpMethod.post),!this.m_Strategy[e.method])throw new Error(`AjaxRpc不支持HttpMethod.${e.method}`);return new Promise(((t,o)=>r(this,void 0,void 0,(function*(){var r;const s=u.createXMLHttpRequest();s.timeout=(null===(r=null==e?void 0:e.header)||void 0===r?void 0:r[n.Header.timeout])?parseInt(e.header[n.Header.timeout]):u.timeout,e.route=e.route.includes("/mh/")?e.route:e.route.replace(c,(e=>e+"/mh")),e.route=this.m_BaseUrl+e.route,this.m_Strategy[e.method].open(s,e),this.appendHeader(s,u.header),this.appendHeader(s,e.header),s.onreadystatechange=()=>{if(s.readyState===d.done)if(200===s.status)try{t(JSON.parse(s.responseText))}catch(e){o({data:null,err:i.panic})}else o({data:null,err:i.panic})},s.ontimeout=()=>{o({data:null,err:i.timeout})},this.m_Strategy[e.method].send(s,e)}))))}))}appendHeader(e,t){Object.keys(null!=t?t:{}).forEach((o=>{e.setRequestHeader(o,t[o])}))}}t.AjaxRpc=u,u.body={},u.header={"Content-Type":"application/json;charset=UTF-8"},u.timeout=15e3,u.createXMLHttpRequest=()=>new XMLHttpRequest},t=>{t.exports=e},(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetRequestStrategy=void 0;const r=o(1);t.GetRequestStrategy=class{open(e,t){const o=Object.entries(Object.assign(Object.assign({},r.AjaxRpc.body),t.body)).reduce(((e,[t,o])=>(e.push(t,"=",o,"&"),e)),[t.route,"?"]);o.pop(),e.open(t.method,o.join(""),!0)}send(e){e.send()}}},(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PostRequestStrategy=void 0;const r=o(1);t.PostRequestStrategy=class{open(e,t){e.open(t.method,t.route,!0)}send(e,t){e.send(JSON.stringify(Object.assign(Object.assign({},r.AjaxRpc.body),t.body)))}}}],o={};function r(e){var n=o[e];if(void 0!==n)return n.exports;var s=o[e]={exports:{}};return t[e].call(s.exports,s,s.exports,r),s.exports}var n={};return(()=>{var e=n;Object.defineProperty(e,"__esModule",{value:!0}),e.AjaxRpc=void 0;const t=r(1);Object.defineProperty(e,"AjaxRpc",{enumerable:!0,get:function(){return t.AjaxRpc}}),globalThis["lite-ts-ajax"]={AjaxRpc:t.AjaxRpc}})(),n})()));